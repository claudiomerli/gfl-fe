<table mat-table [dataSource]="actualPage.content" class="w-100" matSort (matSortChange)="onSortChange($event)">
  <ng-container matColumnDef="id">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
    <td mat-cell *matCellDef="let project"> {{project.id}} </td>
  </ng-container>

  <ng-container matColumnDef="name">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Nome</th>
    <td mat-cell *matCellDef="let project"> {{project.name}} </td>
  </ng-container>

  <ng-container matColumnDef="customer.name">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Cliente</th>
    <td mat-cell *matCellDef="let project"> {{project.customer?.name}} </td>
  </ng-container>

  <ng-container matColumnDef="status">
    <th mat-header-cell *matHeaderCellDef>Stato</th>
    <td mat-cell *matCellDef="let project"> {{project.status}} </td>
  </ng-container>

  <ng-container matColumnDef="chiefEditor" >
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Capo Redattore</th>
    <td mat-cell *matCellDef="let project"> {{project.chiefEditor?.fullname}} </td>
  </ng-container>

  <ng-container matColumnDef="actions">
    <th mat-header-cell *matHeaderCellDef>Azioni</th>
    <td mat-cell *matCellDef="let project">
      <button mat-icon-button [routerLink]="['/projects',project.id]" *isAuthenticated="['ADMIN', 'CUSTOMER']"
              title="Modifica">
        <mat-icon>edit</mat-icon>
      </button>
      <button mat-icon-button title="Elimina progetto" (click)="delete.emit(project)" *isAuthenticated="['ADMIN']">
        <mat-icon>delete</mat-icon>
      </button>
      <button mat-icon-button (click)="apriDettaglioProgetto(project)" title="Vedi dettaglio">
        <mat-icon>search</mat-icon>
      </button>
      <button mat-icon-button (click)="assegnaProgetto(project)" title="Assegna progetto" *isAuthenticated="['ADMIN']">
        <mat-icon>assignment_ind</mat-icon>
      </button>
      <a mat-icon-button [routerLink]="'/contents'" [queryParams]="{projectId: project?.id}"
         title="Gestisci redazionali">
        <mat-icon>history_edu</mat-icon>
      </a>
      <ng-container *isAuthenticated="['ADMIN']">
        <button mat-icon-button *ngIf="showChangeStatusButton && project.nextState && isInAvailableStatus(project)"
                class="btn btn-primary btn-sm m-1" (click)="changeStatus.emit(project)" title="Cambia stato">
          <mat-icon>settings</mat-icon>
        </button>
      </ng-container>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
</table>
<mat-paginator [pageSizeOptions]="[5, 10, 20]"
               showFirstLastButtons
               [length]="actualPage.totalElements"
               [pageSize]="actualPaginationRequest.pageSize"
               (page)="onPageChange($event)"
               aria-label="Select page of periodic elements">
</mat-paginator>


<app-modal #modalAssegnazione [size]="modalSizeSM" (close)="ripulisciFormAssegnazione()" *isAuthenticated="['ADMIN']">
  <div body>
    <div class="alert alert-warning" role="alert" *ngIf="!listUtenti || listUtenti.length == 0">
      Non ci sono capi redattore
    </div>
    <div class="row">
      <div class="col">
        <label for="utente" class="form-label">Capo Redattore</label>
        <select name="utente" id="utente" class="form-select" [formControl]="userIdControl"
                [validationMessage]="assegnazioneFormSubmitted">
          <option value="">&#45;&#45; Seleziona un capo redattore</option>
          <option *ngFor="let utente of listUtenti" value="{{utente.id}}">{{utente.fullname}}</option>
        </select>
        <app-errors [control]="assegnazioneForm?.controls?.userId"
                    [formSubmitted]="assegnazioneFormSubmitted"></app-errors>
      </div>
    </div>
  </div>
  <div footer>
    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" (click)="assegna()">Assegna</button>
  </div>
</app-modal>
